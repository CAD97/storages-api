<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Types which can be used to store objects."><meta name="keywords" content="rust, rustlang, rust-lang, Storage"><title>Storage in storage_api - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><script defer src="../main.js"></script>
    <noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../storage_api/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../storage_api/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Storage</a></h2><div class="sidebar-elems"><section><div class="block"><h3 class="sidebar-title"><a href="#associated-types">Associated Types</a></h3><ul><li><a href="#associatedtype.Handle">Handle</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#required-methods">Required Methods</a></h3><ul><li><a href="#tymethod.create">create</a></li><li><a href="#tymethod.destroy">destroy</a></li><li><a href="#tymethod.resolve">resolve</a></li><li><a href="#tymethod.resolve_mut">resolve_mut</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div></section><h2 class="location"><a href="index.html">In storage_api</a></h2><div id="sidebar-vars" data-name="Storage" data-ty="trait" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../storage_api/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Trait <a href="index.html">storage_api</a>::<wbr><a class="trait" href="#">Storage</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/storage_api/traits.rs.html#27-87">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="docblock item-decl"><pre class="rust trait"><code>pub unsafe trait Storage {
    type <a href="#associatedtype.Handle" class="associatedtype">Handle</a>&lt;T:&nbsp;?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>&gt;: <a class="trait" href="trait.Handle.html" title="trait storage_api::Handle">Handle</a>&lt;T&gt;;
    unsafe fn <a href="#tymethod.create" class="fnname">create</a>&lt;T:&nbsp;?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;meta: &lt;T as <a class="trait" href="https://doc.rust-lang.org/nightly/core/ptr/metadata/trait.Pointee.html" title="trait core::ptr::metadata::Pointee">Pointee</a>&gt;::<a class="associatedtype" href="https://doc.rust-lang.org/nightly/core/ptr/metadata/trait.Pointee.html#associatedtype.Metadata" title="type core::ptr::metadata::Pointee::Metadata">Metadata</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;Self::<a class="associatedtype" href="trait.Storage.html#associatedtype.Handle" title="type storage_api::Storage::Handle">Handle</a>&lt;T&gt;, <a class="struct" href="https://doc.rust-lang.org/nightly/core/alloc/struct.AllocError.html" title="struct core::alloc::AllocError">AllocError</a>&gt;;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.destroy" class="fnname">destroy</a>&lt;T:&nbsp;?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>&gt;(&amp;mut self, handle: Self::<a class="associatedtype" href="trait.Storage.html#associatedtype.Handle" title="type storage_api::Storage::Handle">Handle</a>&lt;T&gt;);
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.resolve" class="fnname">resolve</a>&lt;T:&nbsp;?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>&gt;(&amp;self, handle: Self::<a class="associatedtype" href="trait.Storage.html#associatedtype.Handle" title="type storage_api::Storage::Handle">Handle</a>&lt;T&gt;) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/core/ptr/non_null/struct.NonNull.html" title="struct core::ptr::non_null::NonNull">NonNull</a>&lt;T&gt;;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.resolve_mut" class="fnname">resolve_mut</a>&lt;T:&nbsp;?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handle: Self::<a class="associatedtype" href="trait.Storage.html#associatedtype.Handle" title="type storage_api::Storage::Handle">Handle</a>&lt;T&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/core/ptr/non_null/struct.NonNull.html" title="struct core::ptr::non_null::NonNull">NonNull</a>&lt;T&gt;;
}</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Types which can be used to store objects.</p>
<p>The behavior of this trait is refined by traits <a href="trait.PinningStorage.html" title="PinningStorage"><code>PinningStorage</code></a>,
<a href="trait.MultipleStorage.html" title="MultipleStorage"><code>MultipleStorage</code></a>, and <a href="trait.SharedMutabilityStorage.html" title="SharedMutabilityStorage"><code>SharedMutabilityStorage</code></a>.</p>
<p>(I’ve used <code>create</code>/<code>destroy</code> to clearly separate this from <code>Allocator</code>’s
<code>allocate</code>/<code>deallocate</code> language, but naming is to be bikeshedded further.)</p>
</div></details><h2 id="associated-types" class="small-section-header">Associated Types<a href="#associated-types" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="associatedtype.Handle" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/storage_api/traits.rs.html#29">source</a></div><h4 class="code-header">type <a href="#associatedtype.Handle" class="associatedtype">Handle</a>&lt;T:&nbsp;?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>&gt;: <a class="trait" href="trait.Handle.html" title="trait storage_api::Handle">Handle</a>&lt;T&gt;</h4></div></summary><div class="docblock"><p>The handle which is used to access</p>
</div></details></div><h2 id="required-methods" class="small-section-header">Required methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="tymethod.create" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/storage_api/traits.rs.html#50-53">source</a></div><h4 class="code-header">unsafe fn <a href="#tymethod.create" class="fnname">create</a>&lt;T:&nbsp;?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self, <br>&nbsp;&nbsp;&nbsp;&nbsp;meta: &lt;T as <a class="trait" href="https://doc.rust-lang.org/nightly/core/ptr/metadata/trait.Pointee.html" title="trait core::ptr::metadata::Pointee">Pointee</a>&gt;::<a class="associatedtype" href="https://doc.rust-lang.org/nightly/core/ptr/metadata/trait.Pointee.html#associatedtype.Metadata" title="type core::ptr::metadata::Pointee::Metadata">Metadata</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;Self::<a class="associatedtype" href="trait.Storage.html#associatedtype.Handle" title="type storage_api::Storage::Handle">Handle</a>&lt;T&gt;, <a class="struct" href="https://doc.rust-lang.org/nightly/core/alloc/struct.AllocError.html" title="struct core::alloc::AllocError">AllocError</a>&gt;</h4></div></summary><div class="docblock"><p>Create an object handle in this storage.</p>
<p>The handled object is not initialized.</p>
<p>(Do we want a <code>create_zeroed</code>?)</p>
<h5 id="safety"><a href="#safety">Safety</a></h5>
<ul>
<li>Any previously created handles have been destroyed.
<ul>
<li>(This can maybe be loosened to it invalidating existing handles?)</li>
</ul>
</li>
<li>The metadata must describe a layout valid for a rust object.
<ul>
<li>This exists due to the safety requirements of <code>size_of_val_raw</code>
and <code>align_of_val_raw</code>. I think we need a way to go compute layout
from metadata safely, with a check that it produces a valid layout.</li>
<li>On each unsized kind, this would imply:
<ul>
<li>slices: size computation uses saturating/checked multiplication</li>
<li>traits: vtable must always be valid (as a safety invariant)</li>
<li>composites: size computation uses saturating/checked addition</li>
<li>externs: any valid metadata must compute valid size/align or None</li>
</ul>
</li>
</ul>
</li>
</ul>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.destroy" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/storage_api/traits.rs.html#63">source</a></div><h4 class="code-header">unsafe fn <a href="#tymethod.destroy" class="fnname">destroy</a>&lt;T:&nbsp;?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>&gt;(&amp;mut self, handle: Self::<a class="associatedtype" href="trait.Storage.html#associatedtype.Handle" title="type storage_api::Storage::Handle">Handle</a>&lt;T&gt;)</h4></div></summary><div class="docblock"><p>Destroy an object handle in this storage.</p>
<p>The handled object is not modified nor required to be valid in any way.</p>
<h5 id="safety-1"><a href="#safety-1">Safety</a></h5>
<ul>
<li>The handle must have previously been created by this storage,
and must not have been destroyed.</li>
</ul>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.resolve" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/storage_api/traits.rs.html#74">source</a></div><h4 class="code-header">unsafe fn <a href="#tymethod.resolve" class="fnname">resolve</a>&lt;T:&nbsp;?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>&gt;(&amp;self, handle: Self::<a class="associatedtype" href="trait.Storage.html#associatedtype.Handle" title="type storage_api::Storage::Handle">Handle</a>&lt;T&gt;) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/core/ptr/non_null/struct.NonNull.html" title="struct core::ptr::non_null::NonNull">NonNull</a>&lt;T&gt;</h4></div></summary><div class="docblock"><p>Resolve an object handle in this storage to a pointer.</p>
<p>The returned pointer is valid <em>for reads only</em> and is invalidated
when the storage is moved or used mutably.</p>
<h5 id="safety-2"><a href="#safety-2">Safety</a></h5>
<ul>
<li>The handle must have previously been created by this storage,
and must not have been destroyed or invalidated.</li>
</ul>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.resolve_mut" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/storage_api/traits.rs.html#86">source</a></div><h4 class="code-header">unsafe fn <a href="#tymethod.resolve_mut" class="fnname">resolve_mut</a>&lt;T:&nbsp;?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self, <br>&nbsp;&nbsp;&nbsp;&nbsp;handle: Self::<a class="associatedtype" href="trait.Storage.html#associatedtype.Handle" title="type storage_api::Storage::Handle">Handle</a>&lt;T&gt;<br>) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/core/ptr/non_null/struct.NonNull.html" title="struct core::ptr::non_null::NonNull">NonNull</a>&lt;T&gt;</h4></div></summary><div class="docblock"><p>Resolve an object handle in this storage to a pointer.</p>
<p>The returned pointer is valid for both reads and writes and is
invalidated when the storage is moved or used mutably. (This includes
but is not limited to further calls to <code>resolve_mut</code>.)</p>
<h5 id="safety-3"><a href="#safety-3">Safety</a></h5>
<ul>
<li>The handle must have previously been created by this storage,
and must not have been destroyed or invalidated.</li>
</ul>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-Storage" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../src/storage_api/alloc.rs.html#26-50">source</a></span><a href="#impl-Storage" class="anchor"></a><h3 class="code-header in-band">impl&lt;A:&nbsp;<a class="trait" href="https://doc.rust-lang.org/nightly/core/alloc/trait.Allocator.html" title="trait core::alloc::Allocator">Allocator</a>&gt; <a class="trait" href="trait.Storage.html" title="trait storage_api::Storage">Storage</a> for <a class="struct" href="struct.AllocStorage.html" title="struct storage_api::AllocStorage">AllocStorage</a>&lt;A&gt;</h3></section></summary><div class="impl-items"><section id="associatedtype.Handle-1" class="type trait-impl has-srclink"><a href="#associatedtype.Handle-1" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.Handle" class="associatedtype">Handle</a>&lt;T:&nbsp;?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>&gt; = <a class="struct" href="https://doc.rust-lang.org/nightly/core/ptr/non_null/struct.NonNull.html" title="struct core::ptr::non_null::NonNull">NonNull</a>&lt;T&gt;</h4></section></div></details><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-Storage-1" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../src/storage_api/inline.rs.html#43-70">source</a></span><a href="#impl-Storage-1" class="anchor"></a><h3 class="code-header in-band">impl&lt;DataStore&gt; <a class="trait" href="trait.Storage.html" title="trait storage_api::Storage">Storage</a> for <a class="struct" href="struct.InlineStorage.html" title="struct storage_api::InlineStorage">InlineStorage</a>&lt;DataStore&gt;</h3></section></summary><div class="impl-items"><section id="associatedtype.Handle-2" class="type trait-impl has-srclink"><a href="#associatedtype.Handle-2" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.Handle" class="associatedtype">Handle</a>&lt;T:&nbsp;?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>&gt; = <a class="struct" href="struct.InlineStorageHandle.html" title="struct storage_api::InlineStorageHandle">InlineStorageHandle</a>&lt;T&gt;</h4></section></div></details><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-Storage-2" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../src/storage_api/small.rs.html#34-88">source</a></span><a href="#impl-Storage-2" class="anchor"></a><h3 class="code-header in-band">impl&lt;DataStore, A:&nbsp;<a class="trait" href="https://doc.rust-lang.org/nightly/core/alloc/trait.Allocator.html" title="trait core::alloc::Allocator">Allocator</a>&gt; <a class="trait" href="trait.Storage.html" title="trait storage_api::Storage">Storage</a> for <a class="struct" href="struct.SmallStorage.html" title="struct storage_api::SmallStorage">SmallStorage</a>&lt;DataStore, A&gt;</h3></section></summary><div class="impl-items"><section id="associatedtype.Handle-3" class="type trait-impl has-srclink"><a href="#associatedtype.Handle-3" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.Handle" class="associatedtype">Handle</a>&lt;T:&nbsp;?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>&gt; = <a class="struct" href="struct.SmallStorageHandle.html" title="struct storage_api::SmallStorageHandle">SmallStorageHandle</a>&lt;T&gt;</h4></section></div></details></div><script type="text/javascript" src="../implementors/storage_api/trait.Storage.js" async></script></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="storage_api" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.62.0-nightly (8bf93e9b6 2022-04-09)" ></div>
</body></html>